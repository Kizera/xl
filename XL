--[[
    ‚ò†Ô∏è JEM DUNGEON CLEARER [Auto Farm + Smart Exit]
    - Teleport ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡∏°‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡∏¥‡∏á‡∏™‡∏Å‡∏¥‡∏•
    - ‡∏°‡∏≠‡∏ô‡∏´‡∏°‡∏î -> ‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏° E (‡∏õ‡∏£‡∏∞‡∏ï‡∏π) ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ -> ‡∏ß‡∏≤‡∏õ‡πÑ‡∏õ‡∏Å‡∏î
]]

-- CONFIGURATION
local CONFIG = {
    HeightOffset = 7,  -- ‡∏•‡∏≠‡∏¢‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡∏°‡∏≠‡∏ô 7 ‡πÄ‡∏°‡∏ï‡∏£ (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ)
    SkillArgs = {"MadaraThird"}, -- ‡∏™‡∏Å‡∏¥‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ
    AutoSkillDelay = 0.5, -- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏™‡∏Å‡∏¥‡∏•
}

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- STATE
local Toggles = {
    AutoFarm = false,
}

------------------------------------------------------
-- üñ•Ô∏è GUI SYSTEM
------------------------------------------------------
if CoreGui:FindFirstChild("JemDungeonUI") then CoreGui.JemDungeonUI:Destroy() end
local ScreenGui = Instance.new("ScreenGui"); ScreenGui.Name = "JemDungeonUI"; ScreenGui.Parent = CoreGui
local MainFrame = Instance.new("Frame"); MainFrame.Name = "MainFrame"; MainFrame.Size = UDim2.new(0, 250, 0, 150); MainFrame.Position = UDim2.new(0.5, -125, 0.2, 0); MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20); MainFrame.Active = true; MainFrame.Draggable = true; MainFrame.Parent = ScreenGui

local Title = Instance.new("TextLabel"); Title.Text = "‚ò†Ô∏è JEM DUNGEON CLEARER"; Title.Size = UDim2.new(1, 0, 0, 40); Title.BackgroundColor3 = Color3.fromRGB(192, 57, 43); Title.TextColor3 = Color3.new(1, 1, 1); Title.Font = Enum.Font.GothamBold; Title.TextSize = 14; Title.Parent = MainFrame

local StatusLbl = Instance.new("TextLabel"); StatusLbl.Text = "Status: Idle"; StatusLbl.Size = UDim2.new(1, 0, 0, 30); StatusLbl.Position = UDim2.new(0, 0, 0, 40); StatusLbl.BackgroundTransparency = 1; StatusLbl.TextColor3 = Color3.fromRGB(255, 200, 0); StatusLbl.Font = Enum.Font.Gotham; StatusLbl.Parent = MainFrame

local ToggleBtn = Instance.new("TextButton"); ToggleBtn.Text = "START AUTO FARM [OFF]"; ToggleBtn.Size = UDim2.new(0.9, 0, 0, 50); ToggleBtn.Position = UDim2.new(0.05, 0, 0, 80); ToggleBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60); ToggleBtn.TextColor3 = Color3.new(1, 1, 1); ToggleBtn.Font = Enum.Font.GothamBold; ToggleBtn.Parent = MainFrame

ToggleBtn.MouseButton1Click:Connect(function()
    Toggles.AutoFarm = not Toggles.AutoFarm
    if Toggles.AutoFarm then
        ToggleBtn.Text = "STOP AUTO FARM [ON]"; ToggleBtn.BackgroundColor3 = Color3.fromRGB(46, 204, 113)
    else
        ToggleBtn.Text = "START AUTO FARM [OFF]"; ToggleBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        StatusLbl.Text = "Status: Stopped"
    end
end)

local CloseBtn = Instance.new("TextButton"); CloseBtn.Text = "X"; CloseBtn.Size = UDim2.new(0, 30, 0, 30); CloseBtn.Position = UDim2.new(1, -30, 0, 0); CloseBtn.BackgroundTransparency = 1; CloseBtn.TextColor3 = Color3.new(1,1,1); CloseBtn.Parent = MainFrame; CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

------------------------------------------------------
-- ‚öôÔ∏è LOGIC SYSTEM
------------------------------------------------------

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏° E (‡∏õ‡∏£‡∏∞‡∏ï‡∏π/‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏ï‡πà‡∏≠)
local function FindExitPrompt()
    -- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ProximityPrompt ‡∏ó‡∏±‡πà‡∏ß‡πÅ‡∏°‡∏û (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ä‡∏∑‡πà‡∏≠ Door)
    for _, desc in ipairs(workspace:GetDescendants()) do
        if desc:IsA("ProximityPrompt") then
            return desc
        end
    end
    return nil
end

task.spawn(function()
    while true do
        task.wait()
        if Toggles.AutoFarm then
            local char = LocalPlayer.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            local mobFolder = workspace:FindFirstChild("Live")

            if root and mobFolder then
                local mobs = mobFolder:GetChildren()
                
                -- [[ CASE 1: ‡∏°‡∏µ‡∏°‡∏≠‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà -> ‡πÑ‡∏•‡πà‡∏Ü‡πà‡∏≤ ]]
                if #mobs > 0 then
                    StatusLbl.Text = "‚öîÔ∏è Killing Mobs: " .. #mobs .. " left"
                    
                    -- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠
                    local target = mobs[1]
                    local tRoot = target:FindFirstChild("HumanoidRootPart") or target:FindFirstChild("Torso")
                    
                    if tRoot then
                        -- 1. ‡∏ß‡∏≤‡∏õ‡πÑ‡∏õ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡∏°‡∏≠‡∏ô (‡∏°‡∏≠‡∏á‡∏•‡∏á‡∏•‡πà‡∏≤‡∏á)
                        root.CFrame = CFrame.new(tRoot.Position + Vector3.new(0, CONFIG.HeightOffset, 0), tRoot.Position)
                        
                        -- 2. ‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤ (‡∏Å‡∏±‡∏ô‡∏£‡πà‡∏ß‡∏á)
                        root.Velocity = Vector3.zero
                        
                        -- 3. ‡∏¢‡∏¥‡∏á‡∏™‡∏Å‡∏¥‡∏•
                        pcall(function()
                            game:GetService("ReplicatedStorage").Remotes.AbilityHandler:FireServer(unpack(CONFIG.SkillArgs))
                        end)
                        task.wait(CONFIG.AutoSkillDelay)
                    else
                        -- ‡∏°‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏ö‡∏±‡πä‡∏Å/‡∏ï‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß -> ‡∏•‡∏ö‡∏°‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏™‡∏≤‡∏¢‡∏ï‡∏≤ (Client side) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏ï‡∏±‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                        target:Destroy()
                    end
                    
                -- [[ CASE 2: ‡∏°‡∏≠‡∏ô‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏•‡∏µ‡πâ‡∏¢‡∏á -> ‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å ]]
                else
                    StatusLbl.Text = "üö™ Finding Exit..."
                    local exitPrompt = FindExitPrompt()
                    
                    if exitPrompt and exitPrompt.Parent then
                        -- ‡∏ß‡∏≤‡∏õ‡πÑ‡∏õ‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏° E
                        local exitPart = exitPrompt.Parent
                        if exitPart:IsA("BasePart") or exitPart:IsA("Model") then
                            local exitPos = exitPart:IsA("Model") and exitPart:GetPivot().Position or exitPart.Position
                            
                            -- ‡πÄ‡∏ä‡πá‡∏Å‡∏£‡∏∞‡∏¢‡∏∞ (‡∏ñ‡πâ‡∏≤‡πÑ‡∏Å‡∏•‡∏Ñ‡πà‡∏≠‡∏¢‡∏ß‡∏≤‡∏õ)
                            if (root.Position - exitPos).Magnitude > 5 then
                                root.CFrame = CFrame.new(exitPos + Vector3.new(0, 2, 0)) -- ‡∏¢‡∏∑‡∏ô‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á
                                StatusLbl.Text = "üöÄ Warping to Exit..."
                                task.wait(0.5)
                            else
                                -- ‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß -> ‡∏Å‡∏î E ‡∏£‡∏±‡∏ß‡πÜ
                                StatusLbl.Text = "üîò Pressing E..."
                                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                                task.wait(0.1)
                                VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                                
                                -- ‡∏™‡∏±‡πà‡∏á‡∏Å‡∏î ProximityPrompt ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏î‡πâ‡∏ß‡∏¢ (‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß)
                                fireproximityprompt(exitPrompt) 
                                task.wait(0.3)
                            end
                        end
                    else
                        StatusLbl.Text = "‚ö†Ô∏è No Exit Found (Waiting...)"
                        task.wait(1)
                    end
                end
            else
                 -- ‡∏Å‡∏±‡∏ô error ‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡∏≤‡∏¢/‡πÅ‡∏°‡∏û‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î
                 task.wait(1)
            end
        end
    end
end)
