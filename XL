--[[
    üéÆ UNIVERSAL FARM GUI [All-in-One]
    - Auto Skill (MadaraThird)
    - Mob Bring (‡∏£‡∏ß‡∏ö‡∏°‡∏≠‡∏ô)
    - Auto Next Stage (‡∏ß‡∏≤‡∏õ‡∏à‡∏ö‡∏î‡πà‡∏≤‡∏ô)
]]

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- SETTINGS (‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤)
local CONFIG = {
    NextStagePos = Vector3.new(497, 15, -72), -- ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏ö‡∏î‡πà‡∏≤‡∏ô
    MobDistance = 15, -- ‡∏£‡∏∞‡∏¢‡∏∞‡∏£‡∏ß‡∏ö‡∏°‡∏≠‡∏ô
    SkillRemoteArgs = {"MadaraThird"} -- ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏Å‡∏¥‡∏•
}

-- STATUS VARIABLES (‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞)
local Toggles = {
    AutoSkill = false,
    MobBring = false,
    AutoNext = false
}

------------------------------------------------------
-- üñ•Ô∏è GUI SYSTEM (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á)
------------------------------------------------------
if CoreGui:FindFirstChild("JemFarmUI") then CoreGui.JemFarmUI:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "JemFarmUI"
ScreenGui.Parent = CoreGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 220, 0, 250)
MainFrame.Position = UDim2.new(0.05, 0, 0.4, 0) -- ‡∏≠‡∏¢‡∏π‡πà‡∏ã‡πâ‡∏≤‡∏¢‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

-- ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
local Title = Instance.new("TextLabel")
Title.Text = "‚ö° JEM FARM HUB"
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundColor3 = Color3.fromRGB(255, 87, 34) -- ‡∏™‡∏µ‡∏™‡πâ‡∏°
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = MainFrame

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°
local function CreateButton(text, yPos, onClick)
    local btn = Instance.new("TextButton")
    btn.Text = text .. " [OFF]"
    btn.Size = UDim2.new(0.9, 0, 0, 35)
    btn.Position = UDim2.new(0.05, 0, 0, yPos)
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.fromRGB(200, 200, 200)
    btn.Font = Enum.Font.Gotham
    btn.Parent = MainFrame
    
    local enabled = false
    btn.MouseButton1Click:Connect(function()
        enabled = not enabled
        if enabled then
            btn.Text = text .. " [ON]"
            btn.BackgroundColor3 = Color3.fromRGB(46, 204, 113) -- ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
            btn.TextColor3 = Color3.new(1, 1, 1)
        else
            btn.Text = text .. " [OFF]"
            btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60) -- ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤
            btn.TextColor3 = Color3.fromRGB(200, 200, 200)
        end
        onClick(enabled)
    end)
    return btn
end

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ
CreateButton("üî• Auto Skill", 50, function(val) Toggles.AutoSkill = val end)
CreateButton("üß≤ Mob Bring", 95, function(val) Toggles.MobBring = val end)
CreateButton("‚è© Auto Next", 140, function(val) Toggles.AutoNext = val end)

-- ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î GUI ‡πÄ‡∏•‡πá‡∏Å‡πÜ
local CloseBtn = Instance.new("TextButton")
CloseBtn.Text = "X"
CloseBtn.Size = UDim2.new(0, 30, 0, 30); CloseBtn.Position = UDim2.new(1, -30, 0, 0); CloseBtn.BackgroundTransparency = 1; CloseBtn.TextColor3 = Color3.new(1,1,1); CloseBtn.Parent = MainFrame
CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

------------------------------------------------------
-- ‚öôÔ∏è FUNCTION LOGIC (‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)
------------------------------------------------------

-- 1. AUTO SKILL LOOP
task.spawn(function()
    while true do
        task.wait(0.1) -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å 0.1 ‡∏ß‡∏¥ (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ)
        if Toggles.AutoSkill then
            local remote = ReplicatedStorage:FindFirstChild("Remotes") and ReplicatedStorage.Remotes:FindFirstChild("AbilityHandler")
            if remote then
                remote:FireServer(unpack(CONFIG.SkillRemoteArgs))
            end
        end
    end
end)

-- 2. MOB BRING LOOP
RunService.RenderStepped:Connect(function()
    if Toggles.MobBring then
        local char = LocalPlayer.Character
        local root = char and char:FindFirstChild("HumanoidRootPart")
        local mobFolder = workspace:FindFirstChild("Live")

        if root and mobFolder then
            local bringPos = root.CFrame * CFrame.new(0, 2, -CONFIG.MobDistance)
            for _, mob in ipairs(mobFolder:GetChildren()) do
                local mRoot = mob:FindFirstChild("HumanoidRootPart") or mob:FindFirstChild("Torso")
                if mRoot then
                    mRoot.CFrame = bringPos
                    mRoot.CanCollide = false
                    mRoot.Velocity = Vector3.zero
                end
            end
        end
    end
end)

-- 3. AUTO NEXT STAGE LOOP
task.spawn(function()
    while true do
        task.wait(1)
        if Toggles.AutoNext then
            local mobFolder = workspace:FindFirstChild("Live")
            if mobFolder and #mobFolder:GetChildren() == 0 then
                -- ‡∏°‡∏≠‡∏ô‡∏´‡∏°‡∏î -> ‡∏ß‡∏≤‡∏õ
                local char = LocalPlayer.Character
                local root = char and char:FindFirstChild("HumanoidRootPart")
                if root then
                    -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏≤‡∏õ (‡∏Å‡∏±‡∏ô‡∏ß‡∏≤‡∏õ‡∏£‡∏±‡∏ß‡πÜ)
                    if (root.Position - CONFIG.NextStagePos).Magnitude > 10 then
                        root.CFrame = CFrame.new(CONFIG.NextStagePos)
                        task.wait(0.5)
                        -- ‡∏Å‡∏î E
                        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                        task.wait(0.1)
                        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                        print("‚è© Warped & Pressed E")
                    end
                end
            end
        end
    end
end)
